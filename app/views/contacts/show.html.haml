- @menu_up_item = 'contacts_show'


- if flash[:info_on_request_added]
  %article.contact-block{style: "margin-left: #{cycle('30px', '20px', '12px', '22px')};"}
    %section
      #note
        =flash[:info_on_request_added].html_safe


- unless @contacts.count == 0 


  - @conter = 1
  - @contacts.each_with_index do |contact, index|
    
    - @receiver_id = contact.user_id.to_s
  
    -# COLOR
    - @color = 'green'       if contact.group == 'GOOD GROUP'    
    - @color = 'saddlebrown' if contact.group == 'MIDDLE GROUP'    
    - @color = 'indigo'      if contact.group == 'BAD GROUP'
    
    - @title_on_hover = 'С этим человеком отношения безопасны'           if contact.group == 'GOOD GROUP'    
    - @title_on_hover = 'С этим человеком строить отношения сложнее, чем с людьми с зеленым квадратом' if contact.group == 'MIDDLE GROUP'    
    - @title_on_hover = 'Построение отношений с этим человеком требует больше усилий'      if contact.group == 'BAD GROUP'          
      
      
    
    -#.white_border
    %article.contact-block{style: "margin-left: #{cycle('30px', '20px', '12px', '22px')};"}
       
      %strong
        .contact-square{style: "background-color: #{@color}; color: #{@color}; ", title: @title_on_hover}
          OO
          .contact-square-info
            ?
        =contact.name        
      
      - unless contact.image.url.match(/missing.png/)     
        .contact-image
          = image_tag contact.image.url      
  
      %address
        =contact.city + ', ' + contact.country
      
      .text-success
        =contact.birthday.strftime("%B %-d, %Y")
      
      .lead
        =contact.about_info   
  
      -#.label.label-success.select_able
        =contact.email        
        
        
        
        
      - @receiver_user_id = contact.user_id          
      - @exist_sent_request    = @requests_of_current_user.find_by receiver: @receiver_user_id
      
      - @exist_income_request    = RequestsForCommunication.where    user_id: @receiver_user_id
      - @exist_income_request    = (@exist_income_request.where      receiver: @user.id).last
      
      
      -#- if @exist_income_request == nil
        - @exist_income_request = @exist_sent_request
        
      - if @exist_sent_request == nil
        - @exist_sent_request = RequestsForCommunication.first  
        - @exist_sent_request.status = 'hello'
      - if @exist_income_request == nil
        - @exist_income_request = RequestsForCommunication.first  
        - @exist_income_request.status = 'hello'        
      
        
      - if (@exist_sent_request and @exist_sent_request.status == 'yes') or (@exist_income_request and @exist_income_request.status == 'yes')
        %section
          %b
            =render partial: 'messages/message_button'
            
      - elsif (@exist_sent_request and @exist_sent_request.status == 'still') or (@exist_income_request and @exist_income_request.status == 'still')
        %hr/
        %section
          %b
            Запрос на общение уже отправлен
      
      - elsif (@exist_sent_request and @exist_sent_request.status == 'no') or (@exist_income_request and @exist_income_request.status == 'no')
        %hr/
        %section
          %b
            Пользователь уже отклонил запрос от Вас
      
      
      - else
        %section
          %b
            =render partial: 'requests_for_communications/new_request_for_communication'                     
        
       
    
      -#%br/
      
      
      -#-if index == 1
      -#  %section
      -#    #form.lead
      -#      %b      
      -#        = render partial: 'consults/consult_form'
      
- else    

  .contact-block  
    .lead 
      -# Email или отложка:
      База создается. Зайдите повторно через несколько дней.
    
    =button_to 'На главную', '/', class: 'btn btn-success btn-large'   
-#______________________________________________________________________________  



-#%section
  #form.lead
    %b
      -#=render partial: 'new_consult_form' 


  
    







